{% extends "base.html" %}
{% block content %}

<!-- BIGGER, MORE PREMIUM CARD -->
<div class="max-w-4xl mx-auto p-10 md:p-12 
    bg-white/10 backdrop-blur-2xl 
    rounded-3xl shadow-2xl border border-white/20 
    space-y-10 mt-16 
    transition-all duration-500 hover:scale-[1.02] hover:shadow-purple-500/50">

  <div class="text-center mb-8">
    <h2 class="text-5xl md:text-6xl font-extrabold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent drop-shadow-lg">
      Admin Panel — Upload Dataset
    </h2>
    <p class="text-xl text-gray-300 mt-4 font-light">Upload only cleaned CSV (no missing values allowed)</p>
  </div>

  <form method="POST" enctype="multipart/form-data" class="space-y-10" onsubmit="showUploadLoader()">

    <!-- Username — Bigger Input -->
    <div class="space-y-3">
      <label class="block text-lg font-bold text-gray-100">Uploader Username</label>
      <input name="upload_user"
        class="w-full px-8 py-5 text-lg rounded-2xl bg-white/10 border border-white/30 
               focus:ring-4 focus:ring-purple-500 focus:border-purple-400
               transition-all duration-300 placeholder-gray-500"
        placeholder="e.g., john_doe" required>
    </div>

    <!-- CSV Upload — Bigger & Better -->
    <div class="space-y-3">
      <label class="block text-lg font-bold text-gray-100">Dataset CSV File</label>
      <input name="dataset" type="file" accept=".csv"
        class="block w-full text-lg file:mr-8 file:py-5 file:px-12 file:rounded-2xl 
               file:border-0 file:text-lg file:font-bold 
               file:bg-gradient-to-r file:from-purple-600 file:via-pink-600 file:to-cyan-600 
               file:text-white hover:file:from-purple-700 hover:file:via-pink-700 hover:file:to-cyan-700
               cursor-pointer transition-all file:shadow-xl"
        onchange="validateFile(this)" required>
      <div id="file-feedback" class="text-base mt-2 min-h-[28px]"></div>
    </div>

    <!-- BIGGER Upload Button -->
    <button type="submit"
      class="w-full py-6 text-2xl font-bold rounded-2xl 
             bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 
             hover:from-purple-600 hover:via-pink-600 hover:to-cyan-600
             shadow-2xl hover:shadow-purple-600/50
             transform transition-all duration-500 
             hover:scale-105 active:scale-98
             flex items-center justify-center gap-4">
      <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
      </svg>
      Upload & Train KNN Model
    </button>
  </form>

  <!-- Enhanced Loader -->
  <div id="upload-loader" class="hidden mt-10 text-center space-y-6">
    <div class="animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto"></div>
    <p class="text-2xl text-gray-200 font-medium">Training your model...</p>
    <div class="w-full bg-gray-700/60 rounded-full h-4 overflow-hidden">
      <div id="progress-bar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-300" style="width: 0%;"></div>
    </div>
  </div>

  <!-- Dataset List — Bigger Cards -->
  {% if datasets %}
  <div class="mt-12">
    <h3 class="text-3xl font-extrabold text-gray-100 mb-6 text-center">Active Trained Models</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for ds in datasets %}
      <div class="bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10 
                  hover:border-purple-400/60 hover:bg-white/10 
                  transition-all duration-400 group">
        <div class="flex items-center justify-between">
          <div>
            <h4 class="text-2xl font-bold text-white">{{ ds }}</h4>
            <p class="text-gray-400 text-sm mt-1">KNN Model • Ready</p>
          </div>
          <div class="flex items-center gap-4">
            <div class="w-4 h-4 bg-emerald-400 rounded-full animate-pulse ring-4 ring-emerald-400/30"></div>
            <button onclick="confirmDelete('{{ ds }}')" 
              class="px-5 py-3 bg-red-900/40 hover:bg-red-800/70 text-red-300 hover:text-white 
                     rounded-xl font-bold text-sm transition-all hover:scale-105">
              Delete
            </button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="mt-10 text-center">
      <p class="text-xl text-gray-300">
        Total Models: 
        <span class="text-5xl font-black text-white ml-3 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
          {{ datasets|length }}
        </span>
      </p>
    </div>
  </div>
  {% endif %}
</div>

<!-- Modal (Bigger & Centered) -->
<div id="delete-modal" class="fixed inset-0 bg-black/70 backdrop-blur-xl hidden flex items-center justify-center z-50 p-6">
  <div class="bg-white/10 border border-white/30 backdrop-blur-2xl p-10 rounded-3xl shadow-2xl max-w-lg w-full 
              animate-[fadeIn_0.4s_ease]">
    <h3 class="text-3xl font-extrabold text-gray-100 mb-6 text-center">Delete Model?</h3>
    <p class="text-xl text-gray-300 text-center mb-8">
      Permanently delete model for <br>
      <span id="delete-dataset" class="font-bold text-purple-300 text-2xl"></span>?
    </p>

    <div class="flex justify-center gap-6">
      <button onclick="closeModal()" 
        class="px-8 py-4 rounded-2xl bg-gray-700/60 hover:bg-gray-600/80 text-xl font-medium text-gray-200 transition">
        Cancel
      </button>
      <a id="confirm-delete-link" href="#"
        class="px-8 py-4 rounded-2xl font-bold text-xl
               bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white transition">
        Yes, Delete
      </a>
    </div>
  </div>
</div>

<script>
  function validateFile(input) {
    const feedback = document.getElementById('file-feedback');
    if (!input.files[0]) { feedback.textContent = ''; return; }

    const file = input.files[0];
    if (file.type !== "text/csv") {
      feedback.innerHTML = "Please upload a valid <strong>.csv</strong> file";
      feedback.className = "text-red-400";
    } else if (file.size > 50 * 1024 * 1024) {
      feedback.innerHTML = "File too large. Max 50MB";
      feedback.className = "text-red-400";
    } else {
      feedback.innerHTML = "Valid CSV file ready!";
      feedback.className = "text-green-400 font-medium";
    }
  }

  function showUploadLoader() {
    document.getElementById("upload-loader").classList.remove("hidden");
    let progress = 0;
    const interval = setInterval(() => {
      progress += 7;
      document.getElementById("progress-bar").style.width = progress + "%";
      if (progress >= 100) clearInterval(interval);
    }, 180);
  }

  function confirmDelete(dataset) {
    document.getElementById("delete-dataset").textContent = dataset;
    document.getElementById("confirm-delete-link").href = "{{ url_for('delete_model', dataset='') }}" + dataset;
    document.getElementById("delete-modal").classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("delete-modal").classList.add("hidden");
  }
</script>

{% endblock %}